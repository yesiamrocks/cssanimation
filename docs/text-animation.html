<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSSAnimation Text Preview Generator</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="./dist/cssanimation.css" type="text/css">

    <style>
            
    </style>
  </head>
  <body
    class="font-sans bg-gray-100 text-gray-800 min-h-screen flex flex-col dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300">
    <div
      class="container max-w-4xl mx-auto p-8 bg-white rounded-xl shadow-xl my-10 flex-grow dark:bg-gray-800 dark:shadow-none transition-colors duration-300">
      <div class="flex justify-between items-center mb-8">
        <h1
          class="text-blue-600 text-center text-4xl font-extrabold dark:text-blue-400 transition-colors duration-300">CSSAnimation
          Text Preview Generator</h1>

        <button id="theme-toggle" aria-label="Toggle dark mode"
          class="p-2 rounded-full text-gray-500 hover:text-gray-700 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:bg-gray-700 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg">
            <path
              d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
          </svg>
        </button>
      </div>

      <div
        class="controls grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8 pb-6 border-b border-gray-200 dark:border-gray-700 transition-colors duration-300">

        <div class="control-group">
          <label for="demoText"
            class="block text-gray-700 font-semibold mb-2 dark:text-gray-200 transition-colors duration-300">Demo
            Text:</label>
          <textarea id="demoText"
            class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 text-base dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 transition-colors duration-300"
            placeholder="Type your text here"></textarea>
        </div>

        <div class="control-group">
          <fieldset>
            <legend
              class="block text-gray-700 font-semibold mb-2 dark:text-gray-200 transition-colors duration-300">Animation
              Type:</legend>
            <div class="checkbox-group space-y-2">
              <div class="flex items-center">
                <input type="radio" id="lt-sequence" name="animationType"
                  value="ca__lt-sequence" checked
                  class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500 mr-2 dark:bg-gray-700 dark:border-gray-600 transition-colors duration-300">
                <label for="lt-sequence"
                  class="text-gray-700 dark:text-gray-200 transition-colors duration-300">Letter
                  Sequence</label>
              </div>
              <div class="flex items-center">
                <input type="radio" id="lt-random" name="animationType"
                  value="ca__lt-random"
                  class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500 mr-2 dark:bg-gray-700 dark:border-gray-600 transition-colors duration-300">
                <label for="lt-random"
                  class="text-gray-700 dark:text-gray-200 transition-colors duration-300">Letter
                  Random</label>
              </div>
              <div class="flex items-center">
                <input type="radio" id="lt-reverse" name="animationType"
                  value="ca__lt-reverse"
                  class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500 mr-2 dark:bg-gray-700 dark:border-gray-600 transition-colors duration-300">
                <label for="lt-reverse"
                  class="text-gray-700 dark:text-gray-200 transition-colors duration-300">Letter
                  Reverse</label>
              </div>
              <div class="flex items-center">
                <input type="radio" id="lt-word" name="animationType"
                  value="ca__lt-word"
                  class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500 mr-2 dark:bg-gray-700 dark:border-gray-600 transition-colors duration-300">
                <label for="lt-word"
                  class="text-gray-700 dark:text-gray-200 transition-colors duration-300">Word-by-Word</label>
              </div>
              <div class="flex items-center">
                <input type="radio" id="lt-line" name="animationType"
                  value="ca__lt-line"
                  class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500 mr-2 dark:bg-gray-700 dark:border-gray-600 transition-colors duration-300">
                <label for="lt-line"
                  class="text-gray-700 dark:text-gray-200 transition-colors duration-300">Line-by-Line</label>
              </div>
            </div>
          </fieldset>
        </div>

        <div class="control-group">
          <label for="animationSearch"
            class="block text-gray-700 font-semibold mb-2 dark:text-gray-200 transition-colors duration-300">Search
            Animation Classes:</label>
          <input type="text" id="animationSearch"
            placeholder="Type to search..."
            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">

          <label for="animationClasses"
            class="block text-gray-700 font-semibold mt-4 mb-2 dark:text-gray-200 transition-colors duration-300">Animation
            Classes (Ctrl/Cmd click for multiple):</label>
          <select id="animationClasses" multiple size="5"
            class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 text-base dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 transition-colors duration-300">
          </select>
          <small
            class="block text-gray-500 mt-1 text-sm dark:text-gray-400">Hold
            Ctrl/Cmd to select multiple.</small>
        </div>

        <div class="control-group">
          <label for="delay"
            class="block text-gray-700 font-semibold mb-2 dark:text-gray-200 transition-colors duration-300">Delay
            (ms, space-separated):</label>
          <input type="text" id="delay" value
            placeholder="e.g., 50 100 150 (min 50 for best results)"
            class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 text-base dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 transition-colors duration-300">
        </div>

        <div class="control-group">
          <label for="baseDuration"
            class="block text-gray-700 font-semibold mb-2 dark:text-gray-200 transition-colors duration-300">Base
            Duration (ms):</label>
          <input type="text" id="baseDuration" value placeholder="e.g., 1000"
            class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 text-base dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 transition-colors duration-300">
        </div>

        <div class="control-group" id="separatorOptions">
          <label for="separator"
            class="block text-gray-700 font-semibold mb-2 dark:text-gray-200 transition-colors duration-300">Line
            Separator:</label>
          <select id="separator"
            class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 text-base dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 transition-colors duration-300">
            <option value>Default (br/newline)</option>
            <option value="dot">Dot (.)</option>
          </select>
        </div>
      </div>

      <button id="applyAnimation"
        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition duration-300 ease-in-out shadow-lg mx-auto block dark:bg-blue-700 dark:hover:bg-blue-800 dark:shadow-xl dark:shadow-blue-900/50">Apply
        & Replay Animation</button>

      <div
        class="preview-area border-2 border-dashed border-gray-300 p-10 bg-gray-50 rounded-xl min-h-[180px] flex items-center justify-center mt-10 dark:bg-gray-700 dark:border-gray-600 transition-colors duration-300">
        <h1 id="previewText"
          class="cssanimation text-5xl md:text-6xl text-gray-800 font-bold leading-tight m-0 p-0 text-center dark:text-gray-100 transition-colors duration-300">CSSAnimation
          Letters Animate</h1>
      </div>

      <div
        class="mt-10 p-6 bg-gray-50 rounded-lg border border-gray-200 dark:bg-gray-700 dark:border-gray-600 transition-colors duration-300">
        <label for="generatedCode"
          class="block text-gray-700 font-semibold mb-3 dark:text-gray-200">Generated
          HTML Code (for copy & paste):</label>
        <textarea id="generatedCode" readonly rows="5"
          class="w-full p-3 text-sm border border-gray-300 rounded-lg bg-white font-mono dark:bg-gray-800 dark:border-gray-600 dark:text-gray-100 select-all cursor-text"
          onclick="this.select()"></textarea>
        <button id="copyCodeBtn"
          class="mt-3 px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors duration-200 text-sm focus:outline-none focus:ring-2 focus:ring-green-500">Copy
          Code</button>
      </div>

      <div
        class="mt-6 p-6 bg-gray-50 rounded-lg border border-gray-200 dark:bg-gray-700 dark:border-gray-600 transition-colors duration-300">
        <label for="shareableUrl"
          class="block text-gray-700 font-semibold mb-3 dark:text-gray-200">Shareable
          URL:</label>
        <input type="text" id="shareableUrl" readonly
          class="w-full p-3 text-sm border border-gray-300 rounded-lg bg-white font-mono dark:bg-gray-800 dark:border-gray-600 dark:text-gray-100 select-all cursor-text"
          onclick="this.select()">
        <button id="copyUrlBtn"
          class="mt-3 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors duration-200 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">Copy
          URL</button>
      </div>

    </div>

    <footer
      class="mt-auto p-6 text-center text-gray-600 bg-gray-200 border-t border-gray-300 text-sm dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 transition-colors duration-300">
      <p>&copy; <span id="current-year"></span> CSSAnimation.io. All rights
        reserved. Made with ❤️ by Shafayetul Islam Pavel.</p>
    </footer>

    <script src="./dist/ca-letteranimation.js"></script>

    <script type="module">
        import { animationClasses } from './animationClasses.js';

        document.addEventListener('DOMContentLoaded', () => {
            const previewTextElement = document.getElementById('previewText');
            const demoTextarea = document.getElementById('demoText');
            const animationTypeRadios = document.querySelectorAll('input[name="animationType"]');
            const animationSearchInput = document.getElementById('animationSearch'); 
            const animationClassesSelect = document.getElementById('animationClasses');
            const delayInput = document.getElementById('delay');
            const baseDurationInput = document.getElementById('baseDuration');
            const separatorOptionsDiv = document.getElementById('separatorOptions');
            const separatorSelect = document.getElementById('separator');
            const applyAnimationButton = document.getElementById('applyAnimation');
            const themeToggleBtn = document.getElementById('theme-toggle');
            const htmlElement = document.documentElement;
            const generatedCodeTextarea = document.getElementById('generatedCode');
            const copyCodeBtn = document.getElementById('copyCodeBtn');
            const shareableUrlInput = document.getElementById('shareableUrl');
            const copyUrlBtn = document.getElementById('copyUrlBtn');

            let allAnimationClasses = [];
            let selectedAnimationClassesArray = [];

            // --- Dark Mode Logic ---
            const currentTheme = localStorage.getItem('theme');
            if (currentTheme) {
                htmlElement.classList.add(currentTheme);
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                htmlElement.classList.add('dark');
            }

            themeToggleBtn.addEventListener('click', () => {
                if (htmlElement.classList.contains('dark')) {
                    htmlElement.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                } else {
                    htmlElement.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                }
            });
            // --- End Dark Mode Logic ---

            // --- URL Parameter Encoding/Decoding ---

            function loadStateFromUrl() {
                const params = new URLSearchParams(window.location.search);

                const text = params.get('text');
                if (text) {
                    demoTextarea.value = text;
                }

                const type = params.get('type');
                if (type) {
                    const radio = document.getElementById(type.replace('ca__lt-', 'lt-'));
                    if (radio) {
                        radio.checked = true;
                        if (radio.value === 'ca__lt-line') {
                            separatorOptionsDiv.style.display = 'block';
                        } else {
                            separatorOptionsDiv.style.display = 'none';
                        }
                    }
                }

                const classes = params.get('classes');
                if (classes) {
                    selectedAnimationClassesArray = classes.split(',');
                    populateAnimationClassesDropdown(); 
                    Array.from(animationClassesSelect.options).forEach(option => {
                        if (selectedAnimationClassesArray.includes(option.value)) {
                            option.selected = true;
                        } else {
                            option.selected = false;
                        }
                    });
                }
                
                const delay = params.get('delay');
                if (delay) {
                    delayInput.value = delay;
                }

                const duration = params.get('duration');
                if (duration) {
                    baseDurationInput.value = duration;
                }

                const separator = params.get('separator');
                if (separator) {
                    separatorSelect.value = separator;
                }
            }

            function saveStateToUrl() {
                const params = new URLSearchParams();

                params.set('text', demoTextarea.value);

                let selectedAnimationType = '';
                animationTypeRadios.forEach(radio => {
                    if (radio.checked) {
                        selectedAnimationType = radio.value;
                    }
                });
                if (selectedAnimationType) {
                    params.set('type', selectedAnimationType);
                }

                const classesToEncode = Array.from(animationClassesSelect.selectedOptions).map(option => option.value);
                if (classesToEncode.length > 0) {
                    params.set('classes', classesToEncode.join(','));
                }

                if (delayInput.value.trim()) {
                    params.set('delay', delayInput.value.trim());
                }
                if (baseDurationInput.value.trim()) {
                    params.set('duration', baseDurationInput.value.trim());
                }
                if (selectedAnimationType === 'ca__lt-line' && separatorSelect.value) {
                    params.set('separator', separatorSelect.value);
                }
                
                const newUrl = window.location.origin + window.location.pathname + '?' + params.toString();
                window.history.replaceState({}, '', newUrl);
                shareableUrlInput.value = newUrl;
            }

            copyUrlBtn.addEventListener('click', () => {
                shareableUrlInput.select();
                navigator.clipboard.writeText(shareableUrlInput.value)
                    .then(() => {
                        copyUrlBtn.textContent = 'Copied!';
                        setTimeout(() => { copyUrlBtn.textContent = 'Copy URL'; }, 2000);
                    })
                    .catch(err => {
                        console.error('Failed to copy URL: ', err);
                        alert('Failed to copy URL. Please copy manually.');
                    });
            });
            // --- End URL Parameter Logic ---


            function populateAnimationClassesDropdown(filter = '') {
                animationClassesSelect.innerHTML = '';
                const filteredClasses = allAnimationClasses.filter(cls => cls.toLowerCase().includes(filter.toLowerCase()));

                filteredClasses.forEach(cls => {
                    const option = document.createElement('option');
                    option.value = cls;
                    option.textContent = cls;
                    animationClassesSelect.appendChild(option);
                });

                Array.from(animationClassesSelect.options).forEach(option => {
                    if (selectedAnimationClassesArray.includes(option.value)) {
                        option.selected = true;
                    }
                });

                if (animationClassesSelect.selectedOptions.length === 0 && animationClassesSelect.options.length > 0) {
                    const defaultOption = Array.from(animationClassesSelect.options).find(opt => opt.value === 'ca__fx-FadeIn');
                    if (defaultOption) {
                        defaultOption.selected = true;
                    } else {
                        animationClassesSelect.options[0].selected = true;
                    }
                }
            }
            
            function ensureCssanimationBaseStyles() { /* (remains unchanged) */ }

            function generateHtmlCode() {
                let htmlString = `<h1 class="cssanimation"`;

                let selectedAnimationType = '';
                animationTypeRadios.forEach(radio => {
                    if (radio.checked) {
                        selectedAnimationType = radio.value;
                    }
                });

                const animationClassesAttr = Array.from(animationClassesSelect.selectedOptions)
                                                        .map(option => option.value)
                                                        .join(' ');
                
                const delayValue = delayInput.value.trim();
                const baseDurationValue = baseDurationInput.value.trim();
                const separatorValue = separatorSelect.value.trim();

                if (selectedAnimationType && animationClassesAttr) {
                    htmlString += ` ${selectedAnimationType}="${animationClassesAttr}"`;
                }
                if (delayValue) {
                    htmlString += ` ca__lt-delay="${delayValue}"`;
                }
                if (baseDurationValue) {
                    htmlString += ` ca__lt-base-duration="${baseDurationValue}"`;
                }
                if (selectedAnimationType === 'ca__lt-line' && separatorValue) {
                    htmlString += ` ca__lt-separator="${separatorValue}"`;
                }

                htmlString += `>${demoTextarea.value}</h1>`;
                generatedCodeTextarea.value = htmlString;
            }


            function updatePreview() {
                console.log('--- updatePreview called ---');

                let selectedAnimationType = '';
                animationTypeRadios.forEach(radio => {
                    if (radio.checked) {
                        selectedAnimationType = radio.value;
                    }
                });
                console.log('Selected Animation Type:', selectedAnimationType);

                selectedAnimationClassesArray = Array.from(animationClassesSelect.selectedOptions).map(option => option.value);

                const animationClassesAttr = selectedAnimationClassesArray.join(' ');
                console.log('Animation Classes for attribute:', animationClassesAttr);


                const delayValue = delayInput.value.trim();
                const baseDurationValue = baseDurationInput.value.trim();
                const separatorValue = separatorSelect.value.trim();

                console.log('Delay:', delayValue, 'Duration:', baseDurationValue, 'Separator:', separatorValue);

                const newTextContent = demoTextarea.value;

                const attributesToRemove = [
                    'ca__lt-sequence', 'ca__lt-random', 'ca__lt-reverse',
                    'ca__lt-word', 'ca__lt-line', 'ca__lt-delay',
                    'ca__lt-base-duration', 'ca__lt-separator'
                ];
                attributesToRemove.forEach(attr => previewTextElement.removeAttribute(attr));
                console.log('Cleared existing ca__lt attributes on previewTextElement.');

                if (selectedAnimationType && animationClassesAttr) {
                    previewTextElement.setAttribute(selectedAnimationType, animationClassesAttr);
                    console.log(`Set animation type attribute: ${selectedAnimationType} = "${animationClassesAttr}"`);
                }

                if (delayValue) {
                    previewTextElement.setAttribute('ca__lt-delay', delayValue);
                    console.log(`Set attribute: ca__lt-delay = "${delayValue}"`);
                } else {
                    previewTextElement.removeAttribute('ca__lt-delay');
                }

                if (baseDurationValue) {
                    previewTextElement.setAttribute('ca__lt-base-duration', baseDurationValue);
                    console.log(`Set attribute: ca__lt-base-duration = "${baseDurationValue}"`);
                } else {
                    previewTextElement.removeAttribute('ca__lt-base-duration');
                }

                if (selectedAnimationType === 'ca__lt-line' && separatorValue) {
                    previewTextElement.setAttribute('ca__lt-separator', separatorValue);
                    console.log(`Set attribute: ca__lt-separator = "${separatorValue}"`);
                } else {
                    previewTextElement.removeAttribute('ca__lt-separator');
                }

                previewTextElement._originalTextContent = newTextContent;
                console.log('Updated _originalTextContent on previewTextElement:', previewTextElement._originalTextContent);


                if (window.CSSAnimationLetter && typeof window.CSSAnimationLetter.reinit === 'function') {
                    console.log('Calling window.CSSAnimationLetter.reinit() for previewTextElement.');
                    window.CSSAnimationLetter.reinit(previewTextElement);
                } else {
                    console.warn('window.CSSAnimationLetter.reinit is not available or not a function. Animation may not re-trigger.');
                    previewTextElement.classList.remove('cssanimation');
                    void previewTextElement.offsetWidth;
                    previewTextElement.classList.add('cssanimation');
                }

                console.log('Re-animation trigger attempt complete.');
                generateHtmlCode(); // Update the generated code display
                saveStateToUrl(); // Save current state to URL
            }

            // --- Event Listeners ---
            demoTextarea.addEventListener('input', updatePreview);
            animationTypeRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    if (radio.value === 'ca__lt-line') {
                        separatorOptionsDiv.style.display = 'block';
                    } else {
                        separatorOptionsDiv.style.display = 'none';
                        separatorSelect.value = '';
                    }
                    updatePreview();
                });
            });
            animationClassesSelect.addEventListener('change', updatePreview);
            delayInput.addEventListener('input', updatePreview);
            baseDurationInput.addEventListener('input', updatePreview);
            separatorSelect.addEventListener('change', updatePreview);
            // --- FIX: Re-added the missing event listener for applyAnimationButton ---
            applyAnimationButton.addEventListener('click', updatePreview); 

            animationSearchInput.addEventListener('input', () => {
                selectedAnimationClassesArray = Array.from(animationClassesSelect.selectedOptions).map(option => option.value);
                populateAnimationClassesDropdown(animationSearchInput.value);
            });

            // --- Initial Setup ---
            allAnimationClasses = animationClasses;
            
            document.getElementById('current-year').textContent = new Date().getFullYear();

            // Load state from URL first, then populate dropdown and update preview
            loadStateFromUrl(); 
            populateAnimationClassesDropdown(); // Populate dropdown based on potentially loaded state
            ensureCssanimationBaseStyles();
            
            const initialRadio = document.querySelector('input[name="animationType"]:checked');
            if (initialRadio.value === 'ca__lt-line') {
                separatorOptionsDiv.style.display = 'block';
            } else {
                separatorOptionsDiv.style.display = 'none';
            }

            updatePreview(); // This will trigger the initial animation based on loaded/default state
        });
        </script>
  </body>
</html>